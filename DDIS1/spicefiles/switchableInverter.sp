**********************************
**** INVERTER: simple example
**********************************

* Simulation setup
*------------------
*Some simulation options
.options post nomod
.option opts fast parhier=local

*Add the 45nm CMOS library. Notice how the path is generated by MATLAB
.lib '/users/start2016/r0364010/Master2/DDIS/DDIS1/Resources/Technology/tech_wrapper.lib ' tt

*Add the .vec file
.vec '/users/start2016/r0364010/Master2/DDIS/DDIS1/m2sfiles/switchableInverter.vec'

.tran 0.001n 10n *Do a transient simulation, final time = 10ns
.probe v i

.param supply = 1


* Voltage sources
*-----------------
Vdd vdd vss supply
Vss vss 0 0 


* Simulated circuit
*-------------------

    Xnot0 in0 sw out0 vdd vss MYXOR multfac=2
    Cap0 out0 vss 10f
    Xnot1 in1 sw out1 vdd vss MYXOR multfac=2
    Cap1 out1 vss 10f
    Xnot2 in2 sw out2 vdd vss MYXOR multfac=2
    Cap2 out2 vss 10f
    Xnot3 in3 sw out3 vdd vss MYXOR multfac=2
    Cap3 out3 vss 10f
    Xnot4 in4 sw out4 vdd vss MYXOR multfac=2
    Cap4 out4 vss 10f
    Xnot5 in5 sw out5 vdd vss MYXOR multfac=2
    Cap5 out5 vss 10f
    Xnot6 in6 sw out6 vdd vss MYXOR multfac=2
    Cap6 out6 vss 10f
    Xnot7 in7 sw out7 vdd vss MYXOR multfac=2
    Cap7 out7 vss 10f
    Xnot8 in8 sw out8 vdd vss MYXOR multfac=2
    Cap8 out8 vss 10f
    Xnot9 in9 sw out9 vdd vss MYXOR multfac=2
    Cap9 out9 vss 10f
    Xnot10 in10 sw out10 vdd vss MYXOR multfac=2
    Cap10 out10 vss 10f
    Xnot11 in11 sw out11 vdd vss MYXOR multfac=2
    Cap11 out11 vss 10f
    Xnot12 in12 sw out12 vdd vss MYXOR multfac=2
    Cap12 out12 vss 10f
    Xnot13 in13 sw out13 vdd vss MYXOR multfac=2
    Cap13 out13 vss 10f
    Xnot14 in14 sw out14 vdd vss MYXOR multfac=2
    Cap14 out14 vss 10f
    Xnot15 in15 sw out15 vdd vss MYXOR multfac=2
    Cap15 out15 vss 10f


* Subcircuits
*-------------
* xor-> ( (b*a')' * (b'*a)' )' using NAND gates
.SUBCKT MYXOR input control output   vdd vss multfac='1'    
      * first calculate inverses with NAND: 
      * MYNAND in1     in2     out     vdd vss multfac='1'
        XinvA  input   input   outinvA vdd vss MYNAND multfac=multfac 
        XinvB  control control outinvB vdd vss MYNAND multfac=multfac 
        * (b*a')'
        Xnand1 outinvA control outnand1 vdd vss MYNAND multfac=multfac 
        * (b'*a)'
        Xnand2 outinvB input   outnand2 vdd vss MYNAND multfac=multfac 
        * combine
        XnandOut outnand1 outnand2 output vdd vss MYNAND multfac=multfac 
.ENDS MYXOR

.SUBCKT MYNAND input1 input2 output vdd vss multfac='1'
*    drain  gate   src  bulk
xMn1 dn1    input1 vss  vss MOSN w='multfac*1.5*120e-9' l='45e-9' * extra factor b/c series -> extra node that has capacitance
xMn2 output input2 dn1  vss MOSN w='multfac*1.5*120e-9' l='45e-9'

xMp1 output input1 vdd  vdd MOSP w='multfac*120e-9' l='45e-9' * not *2 b/c pMOS in parallel for NAND -> only half size needed
xMp2 output input2 vdd  vdd MOSP w='multfac*120e-9' l='45e-9'
.ENDS MYNAND

.END


